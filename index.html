<!DOCTYPE html>
<html>
<head>
	<title>Coordinates Generator</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="css/bootstrap-theme.min.css">
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximun-scale=1.0, minimun-scale=1.0">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.timer.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?v=3&key=AIzaSyAHd6KyYBd0Ux6e7ureks9uHpANNhDBfP4&libraries=drawing"></script>
	<script>
    var map;
    var drawingManager;
    var coordinates = [];
    var shape;
    var south,north,east,west;
    var southToNorth,westToEast,currentPosition;

	function initMap() {
		map = new google.maps.Map(document.getElementById('map'), {
			center: {lat: -34.397, lng: 150.644},
			zoom: 8
		});

		drawingManager = new google.maps.drawing.DrawingManager({
			drawingMode: google.maps.drawing.OverlayType.MARKER,
			drawingControl: true,
			drawingControlOptions: {
			  position: google.maps.ControlPosition.TOP_CENTER,
			  drawingModes: [
			    //google.maps.drawing.OverlayType.CIRCLE,
			    //google.maps.drawing.OverlayType.POLYGON,
			    google.maps.drawing.OverlayType.RECTANGLE
			  ]
			}
		});

		drawingManager.setMap(map);

		google.maps.event.addListener(drawingManager, 'circlecomplete', function(circle) {
			createShape(circle,'C');
		});

		google.maps.event.addListener(drawingManager, 'rectanglecomplete', function(event) {
			createShape(event,'R');
			generateCoordinates();
		});

		google.maps.event.addListener(drawingManager, 'polygoncomplete', function(event) {
			createShape(event,'P');
			generateCoordinates(event);
		});

	}

	function createShape(data,type)
	{

		var coords = [];
		/*
		var vData = data.latLngs.j[0].j;
		for(var i = 0; i < vData.length;i++)
		{
			objectLocal = {
				lat: vData[i].lat(),
				lng: vData[i].lng()
			};
			coords.push(objectLocal);
		}
		*/
		north = data.bounds.getNorthEast().lat();
		east = data.bounds.getNorthEast().lng();
		south = data.bounds.getSouthWest().lat();
		west = data.bounds.getSouthWest().lng();


		shape = new google.maps.Rectangle({
		bounds: {
			north: north,
			south: south,
			east: east,
			west: west
		}
		});
		console.log(shape);
		/*
		switch(type)
		{
			case 'P':
				shape = new google.maps.Polygon({paths: coords});
				break;
			case 'R':
				break;
			case 'C':
				break;
		}
		*/
		/*
		var latLong = getLatLngFromString('-34.429567134705266','150.88623046875')
		if(shape.getBounds().contains(latLong))
		{
			alert('Contiene');
		}
		else
		{
			alert('No Contiene');
		}
		/*
		if(google.maps.geometry.poly.containsLocation(latLong, shape))
		{
			alert('Contiene');
		}
		else
		{
			alert('No Contiene');
		}
		/*
		google.maps.event.addListener(map, 'click', function(e) {
			if(google.maps.geometry.poly.containsLocation(e.latLng, shape))
			{
				alert('Contiene');
			}
			else
			{
				alert('No contiene');
			}
	  	});
		
		console.log(shape);
		*/
	}

	function getLatLngFromString(lat,lng) {
		return new google.maps.LatLng(parseFloat(lat), parseFloat(lng));
	}

	function getInitialPosition()
	{
		if($('#southToNorthS').is(':checked'))
		{
			southToNorth = 's';
		}
		else
		{
			southToNorth = 'n';
		}

		if($('#westToEastW').is(':checked'))
		{
			westToEast = 'w';
		}
		else
		{
			westToEast = 'e';
		}

		if(southToNorth == 's' && westToEast == 'w')
		{
			currentPosition = getLatLngFromString(south,west);
		}

		if(southToNorth == 's' && westToEast == 'e')
		{
			currentPosition = getLatLngFromString(south,east);
		}

		if(southToNorth == 'n' && westToEast == 'w')
		{
			currentPosition = getLatLngFromString(north,west);
		}

		if(southToNorth == 'n' && westToEast == 'e')
		{
			currentPosition = getLatLngFromString(north,east);
		}

		return currentPosition;
	}

	function generateCoordinates(data)
	{
		var exit = false;
		var countNotFound = 0;
		var currentLat,currentLng,nextLat,nextLng;
		var currentPosition = getInitialPosition();
		do
		{
			if(shape.getBounds().contains(currentPosition))
			{
				coordinates.push(currentPosition);

				if(countNotFound > 0)
				{
					countNotFound = 0;
					southToNorth = (southToNorth == 's') ? 'n' : 's';
				}

				if(southToNorth == 's')
				{
					currentLat = currentPosition.lat();
					currentLng = currentPosition.lng();

					nextLat = currentLat + 0.00005;
					nextLng = currentLng;
				}
				else
				{
					currentLat = currentPosition.lat();
					currentLng = currentPosition.lng();

					nextLat = currentLat - 0.00005;
					nextLng = currentLng;	
				}
				currentPosition = getLatLngFromString(nextLat,nextLng);
			}
			else
			{
				countNotFound++;
				if(countNotFound < 2)
				{
					if(westToEast == 'e')
					{
						currentLat = currentPosition.lat();
						currentLng = currentPosition.lng();

						if(currentLat <= north && currentLat >= south)
						{
							nextLat = currentLat;							
						}
						else
						{
							if(southToNorth == 's')
							{
								nextLat = currentLat - 0.00005;
							}
							else
							{
								nextLat = currentLat + 0.00005;	
							}
						}

						nextLng = currentLng - 0.00005;
					}
					else
					{
						currentLat = currentPosition.lat();
						currentLng = currentPosition.lng();

						if(currentLat <= north && currentLat >= south)
						{
							nextLat = currentLat;							
						}
						else
						{
							if(southToNorth == 's')
							{
								nextLat = currentLat - 0.00005;
							}
							else
							{
								nextLat = currentLat + 0.00005;	
							}
						}

						nextLng = currentLng + 0.00005;
					}
					currentPosition = getLatLngFromString(nextLat,nextLng);
				}
				else
				{
					exit = true;
				}
				//Busco para la derecha o izquierda
			}
		}while(!exit);

		console.log(coordinates);
		chooseDrawType();
		
	}

	function drawPath()
	{
		var positionsGenerated = new google.maps.Polyline({
			path: coordinates,
			geodesic: true,
			strokeColor: '#FF0000',
			strokeOpacity: 1.0,
			strokeWeight: 2
		});

		positionsGenerated.setMap(map);
	}

	function showCoordinatesWrap()
	{
		var valText = '';
		for(var i=0;i<coordinates.length;i++)
		{
			valText += coordinates[i].lat() +','+coordinates[i].lng() + ';';
		}
		$('#resultCoordinates').val(valText);
	}

	function showCoordinates()
	{
		var valText = '';
		for(var i=0;i<coordinates.length;i++)
		{
			valText += coordinates[i].lat() +','+coordinates[i].lng() + '\n';
		}
		$('#resultCoordinates').val(valText);
	}

	function chooseDrawType()
	{
		drawPath();
		if($('#wrapCheck').is(':checked'))
		{
			showCoordinatesWrap();
		}
		else
		{
			showCoordinates();
		}
	}
	

	$(document).ready(function(){
		initMap();
	})
	</script>
</head>
<body>
	<div class="container">
		<div class="row">
			<h1>Coordinate Generator</h1>
		</div>
		<div class="row">
			<div class="col-xs-8" style="height:400px">
				<div id="map" style="height:100%">
					
				</div>
			</div>
			<div class="col-xs-4">
				<div class="form-group">
					<div class="col-sm-12 bg-info" align="center">
						<div class="checkbox">
							<label>
							<input id="wrapCheck" type="checkbox" onclick="chooseDrawType();"> Wrap
							</label>
						</div>
					</div>
				
					<textarea class="form-control" id="resultCoordinates" style="width:100%" rows="15">Coordinates</textarea>
				</div>
			</div>
		</div>
		<div class="row col-xs-8">
			<div class="col-xs-6">
				<div class="radio">
				<label>
					<input type="radio" name="bottomToTop" id="southToNorthS" value="s" checked>
					South
				</label>
				</div>
				<div class="radio">
				<label>
					<input type="radio" name="bottomToTop" id="southToNorthN" value="n">
					North
				</label>
				</div>
			</div>
			<div class="col-xs-6">
				<div class="radio">
				<label>
					<input type="radio" name="leftToRight" id="westToEastW" value="w" checked>
					West
				</label>
				</div>
				<div class="radio">
				<label>
					<input type="radio" name="leftToRight" id="westToEastE" value="e">
					East
				</label>
				</div>
			</div>
		</div>
		<div class="row col-xs-12">
			<button type="button" class="btn btn-primary">Generate</button>
		</div>
	</div>
</body>
</html>